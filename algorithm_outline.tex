
\subsection{The Witt Vectors}

We begin by defining the Witt vectors. 
Since the theory of Witt vectors is a vast and active topic of research,
we only recall the bare minimum 
required for the quasi-F-split Fedder's criterion algorithm.
For a more complete introduction to the Witt vectors with proofs, 
see \cite{rabinoff-2014-witt-vec}.
For an intuitive introduction/derivation of the Witt vectors, see
\cite{kim-2017-witt-vec}.
There are many other perspectives on Witt vectors. 
For example:
\cite[Chapter~17]{hazewinkel-1978-formal-groups} covers the Witt vectors
and its relationship with formal groups; 
\cite{kedlaya-2021-prismatic} gives a categorical perspecitve on Witt vectors
that relates to lifts of the Frobenius; and
\cite[Chapter~1]{schneider-2017-galois-rep-phi-gamma} defines a generalization
known as the \textit{ramified Witt vectors} in detail.

\begin{defn}
	The \(n\)-th Witt Polynomial \(\omega_{n}\) is defined as
	\[
		\omega_{n}(X_{0}, \ldots, X_{n}) = X_{0}^{p^{n}} + pX_{1}^{p^{n-1}} + \ldots + p^{n}X_{n}
	\] 
\end{defn}

Now let \(R\) be a ring of characteristic \(p\).
We define the map \(\Phi\) to be the map 
\[
	\prod_{n \in \mathbb{N}}^{} R 
	\xrightarrow{(\omega_{n})_{n}} 
	\prod_{n \in \mathbb{N}}^{} R  
\] 
defined as \(\omega_{n}\) for the \(n\)-th component.

\begin{lem}
	There exist integer polynomials 
	\(S_n(X_{0}, \ldots, X_{n}, Y_{0}, \ldots, Y_{n})\) 
	with the property that 
	\[
		\Phi((S_{n})_{n \in \mathbb{N}}) =
		\Phi((X_{n})_{n \in \mathbb{N}}) 
		+ \Phi((Y_{n})_{n \in \mathbb{N}})
	.\] 
	Likewise, there exist integer polynomials 
	\(P_{n}(X_{0}, \ldots, X_{n}, Y_{0}, \ldots, Y_{n})\)
	such that
	\[
		\Phi((P_{n})_{n \in \mathbb{N}}) =
		\Phi((X_{n})_{n \in \mathbb{N}}) 
		\cdot \Phi((Y_{n})_{n \in \mathbb{N}})
	.\] 
\end{lem}

\begin{proof}
	\cite[Theorem~2.6]{rabinoff-2014-witt-vec} and the 
	surrounding discussion, for example.
\end{proof}

We now define the ring of Witt vectors 
\(W(R)\) to be 
\(\prod_{n \in \mathbb{N}}^{} R \) 
as a set, with the ring structure defined
by 
\[
	(a_{n})_{n \in \mathbb{N}} + 
	(b_{n})_{n \in \mathbb{N}} =
	(S_{n}(a_{0}, \ldots, a_{n}, b_{0}, \ldots, b_{n}))_{n \in \mathbb{N}}
\] 
and likewise multiplication is defined
using the \(P_{n}\).
The lemma then shows that \(\Phi\) is a homomorphism 
\[
	W(R) \xrightarrow{} \prod_{n \in \mathbb{N}}^{} R 
.\] 
Moreover, the fact that the polynomials do not depend on the base
ring \(R\) means that the construction is functorial; that is,
for a map of rings \(R \xrightarrow{} R^{\prime} \), we get a 
map \(W(R) \xrightarrow{} W(R^{\prime})\).

The main example, which also provides the fundamental motivation
for the Witt vectors, is the case when \(R = \mathbb{F}_{p}\).
It is well known that \(W(\mathbb{F}_{p}) = \mathbb{Z}_{p}\), 
giving an alternative construction of the \(p\)-adic numbers.

\begin{warn}
    %However, we caution the reader that 
	If one takes a
    naive \(p\)-adic expansion 
    \(\sum_{n = 0}^{\infty} c_{n}p^{n} \in \mathbb{Z}_{p}\)
    with \(c_{n} \in \{0, \ldots, p-1\}\), this does not correspond
    to the Witt vector \((c_{0}, c_{1}, c_{2}, \ldots)\).
    In fact, the aforementioned sum corresponds to 
    \((c_{0}, c_{1}^{p}, c_{2}^{p^{2}}, \ldots)\), see
    (e.g. cite Kim section 2, perhaps rabinoff). 
    This motivates the following, which we recall without proof:
\end{warn}


\begin{defn}
	There exists a homomorphism \(F \colon W(R) \xrightarrow{} W(R)\),
	called the \textit{Frobenius},
	defined by
	\[
	 (c_{0}, c_{1}, \ldots) \mapsto (c_{0}^{p}, c_{1}^{p}, \ldots)
	\] 
	(this is induced by the Frobenius on \(R\) by functoriality).
\end{defn}

\begin{defn}
	There exists a homomorphism \(V \colon W(R) \xrightarrow{} W(R)\),
	called the \textit{Vershibung},
	defined by
	\[
		(c_{0}, c_{1}, c_{2}, \ldots) \mapsto  (0, c_{0}, c_{1}, \ldots)
	\] 
\end{defn}

\begin{lem}
	The composition \(F \circ V = V \circ F\) is the multiplication by
	\(p\) map on \(W(R)\).
\end{lem}

\begin{proof}
	\cite[Proposition~5]{kim-2017-witt-vec}
\end{proof}

Thus, we see that \(W(R) / pW(R) \isom R\).
This is sometimes called the first \textit{truncated}
Witt vectors.
We also have higher truncated variants.

\begin{defn}
	The \(n\)-truncated Witt vectors
	\(W_{n}(R)\) are defined as
	\(W(R) / p^{n}W(R)\).
\end{defn}

By the above lemma, this translates to an actual truncation
in the coordinates of the Witt vectors.

\begin{rmk}
	\label{rmk:polyraise:w2}
    Our computations will end up primarily involving
    \(W_{2}(R)\)\footnote{
    This comes from the delta formula,
    \cite[Theorem~D]{kty-2022-fedder}},
    where addition is governed by the polynomials
	\(S_{0}(X_{0}, Y_{0}) = X_{0} + Y_{0}\)
	and
	\[
		S_{1}(X_{0}, X_{1}, Y_{0}, Y_{1})
		= X_{1} + Y_{1} + 
		\frac{(X_{0} + Y_{0})^{p} - X_{0}^{p} - Y_{0}^{p}}{p}
	.\] 
	Thus we see that addition in \(W_{2}(R)\) involves raising 
	things in \(R\) (i.e. the first component) to the \(p\)-th
	power in the integers.
	%This is the first place that raising polynomials
	%to the \(p\)-th power comes into the picture 
	%algorithmically.
\end{rmk}




\subsection{Splittings of Frobenius}

Let \(R\) be a ring of characteristic \(p\). 
We have the Frobenius morphism 
\(F \colon R \xrightarrow{} R\), 
defined as \(F(x) = x^p\).
We describe a few alternative perspectives on
the Frobenius which will be useful later.

\begin{rmk}
	\label{rmk:frob:perspectives}

    \begin{enumerate}[(1)]
    	\item Let \(R\) be reduced. 
    		Then we may view the Frobenius as the inclusion
    		\(R \ins R^{1 / p}\), where \(R^{1 / p}\) 
    		is the ring of formal \(p\)-th roots of elements
    		of \(R\).
    	\item Similarly, again assuming that \(R\) is reduced
    		we may view the Frobenius as the inclusion
    		\(R^{p} \ins R\), 
    	\item More generally, we define \(F_{\star}R\) to
			be the \(R\)-algebra with ring structure 
			the same as \(R\), with module structure
			\(r \cdot x = F(r)x = r^{p}x\).
			Then we view the Frobenius as a map
			\(R \xrightarrow{} F_{\star}R\).
			In this description, \(F\) is a module 
			homomorphism as well. 
			The module \(F_{\star}R\) corresponds to the
			pushforward construction from geometry
			(i.e. pushforward of quasi-coherent
			sheaves on \(\Spec R\)).
			Even more generally, for any \(R\)-module
			\(M\) we denote \(F_{\star}M\) to be
			the analogously defined pushforward by
			Frobenius.
    \end{enumerate}
\end{rmk}

\begin{defn}
	We say that \(R\) is \(F\)-split if the map \(F\) is
	split as a map of 
	\(R\)-modules \(R \xrightarrow{} F_{\star}R\).
\end{defn}

We will be cheifly concerned with \textit{hypersurfaces},
so we specialize to this case now.

\begin{defn}
	Let \(S = k[x_{1}, \ldots, x_{n}]\).
	Then \(f \in S\) is \(F\)-split if 
	\(S / (f)\) is.
\end{defn}

A fundamental fact about \(F\)-splitness is that there
exists a very concrete criterion for whether or 
not a polynomial (hypersurface) \(f\) is \(F\)-split.
First, though, we introduce some notation.
If \(I = (x_{1}, \ldots, x_{n})\) is a finitely generated 
ideal of some ring \(R\), 
then \(I^{[m]}\)
is defined to be \((x_{1}^{m}, \ldots, x_{n}^{m})\)

\begin{thm}
	[Fedder's Criterion]
	Let \(f \in S = k[x_{1}, \ldots, x_{n}]\).
	Let \(\mathfrak{m} = (x_{1}, \ldots, x_{n})\) 
	be the ideal generated by the variables.
	Then \(f\) is \(F\)-split if and only if 
	\(f^{p-1} \notin \mathfrak{m}^{[p]}\)
\end{thm}

\begin{proof}
	See \cite[Theorem~2.5]{ma-polstra-2021-F-sing-comm-alg}
\end{proof}

\begin{rmk}
	Fedder's criterion is the second place where raising
	homogeneous polynomials to powers enters the picture
	algorithmically.
	This time, unlike Remark \ref{rmk:polyraise:w2},
	the raising to a power happens in characteristic \(p\).
\end{rmk}

Particular interest is in the case when \(f\) is 
homogeneous of degree \(n\), which geometrically
corresponds to a \textit{Calabi-Yau} hypersurface.
In this case, we have

\begin{thm}
	\label{thm:fsplit:ordinary}
	If \(f \in S\) 
	homogeneous of degree \(n\) 
	is \(F\)-split,
	then the Artin-Mazur height 
	of \(Z(f) = \Proj (S / (f))\) 
	is 1, i.e. \(Z(f)\) is weakly ordinary.
\end{thm}

Recently, in \cite{yobuko-2019-qfs-calabi-yau}
Yobuko introduced the notion of 
quasi-\(F\)-splitness, which generalizes \(F\)-splitness.

\begin{defn}
	The ring \(R\) is \(n\)-quasi-\(F\)-split if there exists
	a map \(\phi \colon W_{n}(R) \xrightarrow{} R\) such that
	\[
	\begin{tikzcd}
		W(R) \arrow{r}{F} \arrow{d}[swap]{} &
		F_{\star}W(R) \arrow{ld}{\phi} \\
	R 
	\end{tikzcd}
	,\]
	where the vertical map is the \(1\)-st Witt vector truncation.

	The quasi-\(F\)-split height of \(R\) is the smallest \(n\) 
	for which \(R\) is \(n\)-quasi-\(F\)-split.

	As above, the quasi-\(F\)-split height of 
	\(f \in S = k[x_{1}, \ldots, x_{n}]\) is that
	of \(R = S / (f)\).
\end{defn}

\begin{rmk}
	Both \(F\)-splitness and quasi-\(F\)-splitness have 
	various geometric
	variants which are more general then the 
	ring-theoretic/affine versions given here. 
	These are covered extensively in the literature, for example
	see \cite{kttwyy-2022-qfs-birat}.
\end{rmk}

The quasi-\(F\)-split height also gives a generalization
of Theorem \ref{thm:fsplit:ordinary}:

\begin{thm}
	If \(f \in S\) is homogenous of degree \(n\),
	then the Artin-Mazur height of \(Z(f)\)
	is equal to the quasi-\(F\)-split height
	of \(f\).
\end{thm}

\begin{proof}
	This is a special case of 
	\cite[Theorem~4.5]{yobuko-2019-qfs-calabi-yau}.
\end{proof}

\subsection{Fedder's criterion for quasi-F-splitness: an algorithmic perspective}

We now describe how the Witt Vectors can be used to calculate the 
quasi-F-split height / Artin-Mazur height of a Calabi-Yau 
hypersurface, using the version of Fedder's criterion in \cite{kty-2022-fedder}.
We will describe the algorithm in more detail, proofs can be
found in \cite{kty-2022-fedder}.

\subsubsection{\(\Delta_{1}\)}

For the following discussion, 
let \(k\) be a perfect field of characteristic \(p\) and 
let \(S := k[x_{1}, \ldots, x_{n}]\).
Let \(f = \sum_{I}^{} a_{I}\mathbf{x}^{I}\) be a polynomial in \(S\).

\begin{defn}
	Let \(\Delta_{1}(f)\)
	be defined by the following equation in \(W_{2}(S)\) :
	\[
		(0, \Delta_{1}(f)) = (f,0) - \sum_{I}^{} (a_{I}\mathbf{x}^{I}, 0) 
	\] 
\end{defn}

The following proposition demonstrates how we can calculate 
\(\Delta_{1}(f)\) algorithmically.

\begin{prop}
	\label{prop:delta1:formula}
	Let \([f]\) be a lift of \(f\) to the integers,
	i.e.
	\(f = \sum_{I}^{} [a_{I}] \mathbf{x}^{I}\).
	If \(k = \mathbb{F}_{p}\),
	we can compute \(\Delta_{1}(f)\) by 
	taking the reduction of
	\[
		\frac{[f]^{p} - \sum_{I}^{} ([a_{I}]x^{I})^{p} }{p}
	\] 
	mod \(p\).
\end{prop}

\begin{proof}
	Iteratively apply the formula for \(S_{1}\) 
	to the monomials of \(f\).
\end{proof}

\begin{rmk}
	If \(f\) is a homogeneous polynomial of degree \(d\), 
	then \(\Delta_{1}(f)\) is a polynomial of degree \(pd\).
\end{rmk}

\subsection{The map \(\theta\)}

Let \(S = k[x_{1}, \ldots, x_{n}]\) as before. 
We will use perspective (3) from
Remark \ref{rmk:frob:perspectives}; 
recall that we idenfity 
\(S\) with the target of frobenius and
\(S^{p}\) with the source.
We see 
by counting degrees
that we have a generating set for \(S\) as an
\(S^{p}\)-module given by
all monomials
\(x_{1}^{i_{1}}\ldots x_{n}^{i_{n}}\)
where \(0 \leq i_{j} \leq p-1\) for all \(j\).
Moreover, since \(S\) is a polynomial ring, 
there are no (module-theoretic) relations
and
\(S\) is a the free \(S^{p}\)-module generated by 
these monomials, i.e.
\[
S = \bigoplus_{1 \leq j \leq n, 0 \leq i_{j} \leq p-1}^{} x_{1}^{i_{1}}\ldots x_{n}^{i_{n}} S^{p}
.\] 
Then the projection to any of the direct sum components
is an element of \(\Hom(R,R^{p})\) which is in fact a
splitting of Frobenius.
Let \(u\) be the projection onto the component of
\(x_{1}^{p-1}, \ldots, x_{n}^{p-1}\).

The map \(u\) plays an important role in \(F\)-singularity
theory, see for example 
\cite[Claim~2.6]{ma-polstra-2021-F-sing-comm-alg}.
For our purposes, we only care about computing \(u\) 
for a polynomial in \(S\). 
Given \(f \in S\), we will first compute
\(u(f) \in S^{p}\), and then use the identifiaction
\(S^{p} \isom S\) by taking \(p\)-th roots of 
exponents.

\begin{alg}
	\label{alg:naive:u}
	Input: \(f\) 
	Output: \(u(f)\) considered as an element of \(S\).

	1. Discard all terms of \(f\) whose exponents are not congruent to
	\((p-1, \ldots, p-1)\) mod p.
	2. subtract \((p-1, \ldots, p-1)\) from the exponent vector of 
	each term, obtaining exponents which are divisble by \(p\).
	3. Divide all exponents by \(p\).
\end{alg}

With that, we may define \(\theta\):

\begin{defn}
	[See the introduction of \cite{kty-2022-fedder}]
	The map \(\theta = \theta_{f}\) is defined by 
	\(\theta_{f}(g) = u(\Delta_{1}(f^{p-1}) \cdot g)\).
	We generally omit the dependence on \(f\) from
	the notation.
\end{defn}

\subsection{The algorithm}

Let \(f\) be a homogeneous polynomial of degree \(n\) 
in \(S\), 
so that \(Z(f)\) is a Calabi-Yau hypersurface.

\begin{alg}
	\label{alg:qfs:outline}

	Inputs: \(b \in \mathbb{N}\) chosen bound, \(f\) a homogeneous
	polynomial of degree \(n\) in \(S\).
	\begin{enumerate}[(1)]
		\item Compute \(f^{p-1}\)
		\item If \(f^{p-1} \notin \mathfrak{m}^{p}\), return \(1\). 
		\item Compute \(\Delta_{1}(f^{p-1})\) via Proposition \ref{prop:delta1:formula}.
		\item Set \(n = 2\) and \(g = f^{p-1}\)
		\item Loop
			\begin{enumerate}[(1)]
				\item \(g := \theta(g)\) (using the output of Step 3)
				\item If \(g \notin \mathfrak{m}^{p},\) return \(n\).
				\item If \(n < b\), return \(\infty\)	
			\end{enumerate}
	\end{enumerate}
\end{alg}

\begin{thm}
	[\cite{kty-2022-fedder}, Theorem C]
	Assume that
	\(Z(f)\) has quasi-F-split height \(h < b\),
	then Algorithm \ref{alg:qfs:outline} terminates
	and returns \(h\).
\end{thm}

\begin{proof}
	This is just rephrasing \cite{kty-2022-fedder}, Theorem C.
\end{proof}

In the case of Calabi-Yau hypersurfaces, we have bounds on the height by
\cite{van-der-geer-katsura-2003-calabi-yau},
so we can deterministically recover the height.  
See also \cite[Theorem~0.1]{artin-1974-k3-surfaces},
for the case of K3 surfaces.
For a K3 surface, the height (if finite) is bounded by 10.

\subsubsection{Our improvements}

A naive implmentation of Algorithm \ref{alg:qfs:outline}
is provided in MMPSingularities.jl.
The bottleneck ends up being polynomial multiplication, 
in two places:
raising \(f^{p-1}\) to the \(p\)-th power in the integers,
and multiplying \(g\) by \(\Delta_{1}(f^{p-1})\) 
in \(\theta\).

For the first, we implement a gpu-based FFT that is
further optimized for homogeneous inputs.
For the second, we observe that \(f^{p-1}\) has degree
\(n(p-1)\). 
Furthermore, we observe that by Remark \ref{} and 
(REF THETA SECTION), \(\theta\) is a linear map
from the vectors space of 
homogenous polynomials of degree \(n(p-1)\) 
to itself.
Thus, if we can efficiently compute the matrix of \(\theta\),
we can repeatedly apply matrix-vector multiplication,
which is much faster.


